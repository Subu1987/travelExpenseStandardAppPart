/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/m/DraftIndicatorState","sap/ui/model/Context","sap/fin/travel/lib/reuse/util/Utils","sap/fin/travel/lib/reuse/util/NavigationUtil"],function(D,C,U,N){"use strict";var _;function c(a){var b={};var d={};var f=false;var I=0;function u(){return"id-"+new Date().valueOf()+"-"+I++;}function g(e,M,E){var O=e.getOwnerComponent().sEntitySet;var i=M.getMetaModel().getODataEntitySet(O);var q=M.getMetaModel().getODataEntityType(i.entityType);var t=E.slice(0,-1);var v=function(x){return x.name.startsWith(t);};var w=q.navigationProperty.filter(v);return w&&w.length===1&&w[0].name||E;}function G(e,M,E){var i=M.getMetaModel().getODataEntitySet(E);var q=M.getMetaModel().getODataEntityType(i.entityType);return q&&q["com.sap.vocabularies.UI.v1.HeaderInfo"]&&q["com.sap.vocabularies.UI.v1.HeaderInfo"].TypeNamePlural.String||E;}function h(M,B){if(B){var P=M.getPendingChanges();for(var e in P){if(e===B.substring(1)){return true;}}return false;}return M.hasPendingChanges();}function j(L){if(L&&L.getTable()&&L.getTable().getItems()){for(var i=0;i<L.getTable().getItems().length;i++){var e=L.getTable().getItems()[i].getBindingContext();if(e&&e.getProperty("DraftLinkVisible")){return e;}}}return undefined;}function k(){return d;}function s(P){if(U.isEmptyObjectOrString(P)){return;}var M=a.getAppModel();if(!U.isEmptyObjectOrString(P.BindingPath)){var t=new C(M,P.BindingPath);var T=t.getObject("");if(U.isEmptyObjectOrString(T)){d.Tripno=P.BindingPath.match(/Tripno='(\d+)'/)&&P.BindingPath.match(/Tripno='(\d+)'/)[1];d.Pernr=P.BindingPath.match(/Pernr='(\d+)'/)&&P.BindingPath.match(/Pernr='(\d+)'/)[1];}else{d.Tripno=t.getProperty("Tripno");d.Pernr=t.getProperty("Pernr");}d.BindingPath=P.BindingPath;}else{if(P.hasOwnProperty("Tripno")){d.Tripno=P.Tripno;}if(P.hasOwnProperty("Pernr")){d.Pernr=P.Pernr;}if(P.hasOwnProperty("BindingPath")){d.BindingPath="";}}}function r(M,B){M.resetChanges(B);}function A(M,e){var i=M.getDeferredGroups();i=i.concat([e]);M.setDeferredGroups(i);}function R(M,e){var i=M.getDeferredGroups();var q=i.indexOf(e);if(q>-1){i.splice(q,1);}M.setDeferredGroups(i);}function l(M,P){var q=true;if(P&&P.hasOwnProperty("refreshAfterChange")&&false===P.refreshAfterChange){q=false;}Object.getOwnPropertyNames(M.getObject("/")).filter(function(e){return-1!==e.indexOf("Pernr='"+P.Pernr+"'");}).filter(function(e){return-1!==e.indexOf("Tripno='"+P.Tripno+"'");}).forEach(function(e,i){if(0!==e.indexOf("/")){e="/"+e;}M.invalidateEntry(e);if(q&&N.isBindingPathDisplayed(e)){M.read(e);}});if(q){M.refresh();}}function m(M,P){var e=M.getObject(P);if(e){M.invalidateEntry(P);if(N.isBindingPathDisplayed(P)){M.read(P);}}}function n(e){var P,E;if(!e){throw new Error("No context");}if(e&&e.getPath){P=e.getPath().split("(")[0];E=P.substring(1);}if(E==null){return null;}else{return e.getModel().getMetaModel().getODataEntitySet(E)&&e.getModel().getMetaModel().getODataEntitySet(E).name;}};function o(M,P){var e;var i=P?P:M.getPendingChanges();for(var q in P){if(M.getPendingChanges().hasOwnProperty(q)){if(0!==q.indexOf("/")){q="/"+q;}e=new C(M,q);M.deleteCreatedEntry(e);}}};function H(M){if(typeof b!=="boolean"){b=M.getRefreshAfterChange();}};function p(M){if(typeof b==="boolean"){M.setRefreshAfterChange(b);b={};}};return{uid:u,hasPendingChanges:h,getNavigationProperty:g,getNavigationPropertyName:G,getDraftItem:j,getCurrentTripContext:k,saveCurrentTripContext:s,resetChanges:r,addDeferredGroupId:A,removeDeferredGroupId:R,getEntitySetFromContext:n,invalidateEntries:l,invalidatEentry:m,deletePendingChanges:o,handleRefreshAfterChange:H,handleBackRefreshAfterChange:p};}return{get:function(){if(!_){throw new Error("ODataModel has not been initialized yet.");}return _;},init:function(a){_=_||c(a);},destroy:function(){_=null;}};},true);
