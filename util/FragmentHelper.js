/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/fin/travel/lib/reuse/util/i18n","sap/ui/model/json/JSONModel","sap/ui/layout/VerticalLayout","sap/m/MessageStrip","sap/m/Dialog","sap/m/DialogType","sap/m/Text","sap/m/Button","sap/ui/core/MessageType","sap/m/VBox","sap/m/MessageBox","sap/m/FlexBox","sap/fin/travel/lib/reuse/util/TravelUtil","sap/fin/travel/lib/reuse/util/Utils","sap/m/List","sap/ui/core/Fragment"],function(I,J,V,M,D,a,T,B,b,c,d,F,e,U,L,f){"use strict";var _;var m;function g(){m=new Map([]);function h(i){if(i.getView().$().closest(".sapUiSizeCompact").length){return"sapUiSizeCompact";}return"";}function G(p,s){var v={};var q;var r={message:[]};var t=p.controller;if(!U.isEmptyObjectOrString(s.draftTripNo)){q={text:s.draftTripNo?(e.TripNumber.Initial===s.draftTripNo?I.get().getText("DRAFT_WARNING_UNKNOWN",s.draftTripNo):I.get().getText("DRAFT_WARNING",s.draftTripNo)):"",type:s.draftTripNo?b.Warning:b.None,showCloseButton:false};r.message.push(q);}var u=new L({});u.bindItems({path:"MessageModel>/message",template:new sap.m.CustomListItem({content:new sap.m.MessageStrip({type:"{MessageModel>type}",text:"{MessageModel>text}",showCloseButton:"{MessageModel>showCloseButton}",showIcon:true})})});v=new V({width:"100%",visible:"{= ${MessageModel>/message}.length > 0}",content:[u]}).addStyleClass("sapUiContentPadding");var P=new D({contentWidth:"25rem",title:s.label,content:[v,s.parameter.form],beginButton:new B({text:s.label,type:"Emphasized",press:function(E){if(s.parameter.getEmptyMandatoryFields().length==0&&s.parameter.getEmptyMandatoryValueHelpFields().length==0&&s.parameter.checkValuesValidityFields()==0){s.success.apply(P,[s.successArg]);}else{var w=[];var x=[];var R=I.get().getText("MANDATORY_FIELD_ERROR");var y=I.get().getText("MANDATORY_VALUE_LIST_FIELD_ERROR");P.getModel("MessageModel").setProperty("/message",[]);if(q){x.push(q);}for(var i=0;i<s.parameter.getEmptyMandatoryFields().length;i++){var z=s.parameter.getEmptyMandatoryFields()[i];var A=jQuery.sap.formatMessage(R,z.getTextLabel());x.push({text:A,type:b.Error,showCloseButton:true});w.push(z.getTextLabel());}for(var i=0;i<s.parameter.getEmptyMandatoryValueHelpFields().length;i++){var z=s.parameter.getEmptyMandatoryValueHelpFields()[i];if(w.indexOf(z.getTextLabel())===-1){var A=jQuery.sap.formatMessage(y,z.getTextLabel());x.push({text:A,type:b.Error,showCloseButton:true});w.push(z.getTextLabel());}}for(var i=0;i<s.parameter.checkValuesValidityFields().length;i++){var H=s.parameter.checkValuesValidityFields()[i];var z=sap.ui.getCore().byId(H);if(z){if(w.indexOf(z.getTextLabel())===-1){var A=jQuery.sap.formatMessage(y,z.getTextLabel());x.push({text:A,type:b.Error,showCloseButton:true});w.push(z.getTextLabel());}}}if(x.length>0){P.getModel("MessageModel").setProperty("/message",x);}}}}),endButton:new B({text:I.get().getText("CANCEL_BUTTON"),press:function(){P.close();s.close.apply(null);}}),afterClose:function(i){P.destroy();}}).addStyleClass("sapUiNoContentPadding").addStyleClass(h(t));P.setModel(new J(r),"MessageModel");return P;}function j(i,s,t,p){if(!i.oDiscardUnSavedDialog){i.oDiscardUnSavedDialog=this.getFragment({id:s,name:"sap.fin.travel.lib.reuse.view.fragments.UnsavedChangesDialog",controller:i,models:{i18n:i.getView().getModel("i18n")}});i.oDiscardUnSavedDialog.setModel(i.getView().getModel());}return new Promise(function(r){sap.ui.core.Fragment.byId(s,"unsavedChangesEditButton").attachPress(function(){i.oDiscardUnSavedDialog.close();r();});sap.ui.core.Fragment.byId(s,"unsavedChangesCancelButton").attachPress(function(){i.oDiscardUnSavedDialog.close();});i.oDiscardUnSavedDialog.setModel(new J({"unsavedChangesQuestion":I.get().getText(i,"DRAFT_LOCKED_BY_USER",[t,p])}),"Dialog");i.oDiscardUnSavedDialog.open();});}function k(i){if(typeof i!=="string"){jQuery.sap.log.info("@deprecated since 1.58, use {@link sap.fin.travel.lib.reuse.util.Fragment.loadFragment} instead");var s=i;if(!m.has(s.id)){if(s&&s.hasOwnProperty("name")){var p=sap.ui.xmlfragment(s.id,s.name,s.controller);if(s.hasOwnProperty("models")){for(var q in s.models){p.setModel(s.models[q],q.toString());}}m.set(s.id,p);}else{return undefined;}}return m.get(s.id);}return m.get(i);}function l(s){return new Promise(function(r){var A=function(i,p,q){if(q&&q.hasOwnProperty("models")){for(var t in q.models){p.setModel(q.models[t],t.toString());}}i.set(q.id,p);r(i.get(s.id));};if(s&&s.hasOwnProperty("name")&&!m.has(s.id)){var N;if(f&&typeof f.load==="function"){f.load(s).then(function(i){A(m,i,s);});}else{A(m,sap.ui.xmlfragment(s.id,s.name,s.controller),s);}}else{r(m.get(s.id));}});}function n(){m.forEach(function(v,i,p){if(v.destroy){v.destroy();}});}function o(s){m.forEach(function(v,i,p){if(i===s&&v.destroy){v.destroy();}});m.delete(s);}function C(s){var i="ACTION_CONFIRM|"+s.name;var p=I.get().hasText(s.controller,i)?I.get().getText(s.controller,i):I.get().getText(s.controller,"ACTION_CONFIRM",[s.label]);d.confirm(p,{title:s.label,onClose:function(A){if(A==="OK"){if(s.success&&typeof s.success==="function"){s.success.apply(null,arguments);}}else if(A==="CANCEL"){if(s.error&&typeof s.error==="function"){s.error.apply(null,arguments);}}}});}return{getFunctionImportDialog:G,getUnsavedDialog:j,getFragment:k,loadFragment:l,destroyAll:n,destroy:o,confirmationDialog:C};}return{get:function(){if(!_){_=g();}return _;},destroy:function(){if(_){_.destroyAll();_=null;}}};},true);
