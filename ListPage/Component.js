/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/UIComponent","sap/fin/travel/lib/reuse/util/BaseComponentHandler","sap/fin/travel/lib/reuse/util/PersistenceHelper","sap/fin/travel/lib/reuse/util/ODataModelUtil","sap/ui/thirdparty/datajs"],function(U,B,P,O,a){"use strict";return U.extend("sap.fin.travel.lib.reuse.ListPage.Component",{metadata:{manifest:"json",config:{fullWidth:true}},init:function(){var m=this.getComponentData().oModel;var t=this;if(sap.ushell&&sap.ushell.Container){var l=function(E){if(!t.bExitCalled){var s=O.get().getCurrentTripContext().Pernr;var S=m.sServiceUrl;var h=m.getHeaders();var c=h["x-csrf-token"];var M="POST";var u=["Pernr='"+s+"'","NewPernr=''"];var b=[];b=b.concat(m["aUrl"+"Params"]);b=b.concat(u);var d=S+"/ExitApplication?"+b.join("&");var f="";if(window.location["orig"+"in"]){f=window.location["orig"+"in"];}else{f=window.location.protocol+"//"+window.location.host;}var D=f+d;$.ajax({url:D,type:'post',headers:{"X-CSRF-Token":c}});t.bExitCalled=true;}sap.ushell.Container.detachLogoutEvent(l);E.preventDefault();};sap.ushell.Container.attachLogoutEvent(l);}$(window).bind("beforeunload",function(){if(!t.bExitCalled){var s=O.get().getCurrentTripContext().Pernr;var S=m.sServiceUrl;var h=m.getHeaders();var M="POST";var u=["Pernr='"+s+"'","NewPernr=''"];var b=[];b=b.concat(m["aUrl"+"Params"]);b=b.concat(u);var c=S+"/ExitApplication?"+b.join("&");var i=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime);var d=i;a.request({headers:{"X-CSRF-Token":h["x-csrf-token"]},async:d,method:"POST",requestUri:c,data:undefined},function(){},function(){});t.bExitCalled=true;}});try{sap.ui.require(["sap/ui/core/CustomizingConfiguration"]);var C=sap.ui.require("sap/ui/core/CustomizingConfiguration");if(undefined!==C){C.activateForComponentInstance(this);}}catch(e){jQuery.sap.log.warning("Customizing Configuration no longer available above ui5 1.97");}this.setModel(m);this.oRouter=this.getComponentData().oRouter;this.oAppManifest=this.getComponentData().oAppManifest;this.sEntitySet=this.getComponentData().sEntitySet;this.oExtension=this.getComponentData().extension;var A=this.getComponentData().oAppResourceBundle;var o=this.getModel("i18n");if(A){A.aPropertyFiles[0].getKeys().forEach(function(k){o.getResourceBundle().aPropertyFiles[0].setProperty(k,A.getText(k));});}U.prototype.init.apply(this,arguments);},destroy:function(){B.destroy();U.prototype.destroy.apply(this,arguments);},exit:function(){if(this.oViewContainer){this.oViewContainer.destroy();delete this.oViewContainer;}},createContent:function(){var t=this;var s={entitySet:this.sEntitySet,extension:this.oExtension,controller:{name:"sap.fin.travel.lib.reuse.ListPage.controller.ListPage"},view:{id:"listPageView",name:"sap.fin.travel.lib.reuse.ListPage.view.ListPage",level:0}};this.oViewContainer=new sap.m.Page(this.createId("rootPage"),{showHeader:false});this.getModel().getMetaModel().loaded().then(function(){B.createComponentContent(t,s);}).catch(function(e){$.sap.log.error("Could not create component content : "+e);});return this.oViewContainer;},getRouter:function(){return this.oRouter;},exitApplication:function(p){p=p||{};if(this.bExitCalled===true){if("function"===typeof p.fnSuccess){p.fnSuccess();}return;}var s=O.get().getCurrentTripContext().Pernr;var m=this.getModel();var n=s;if(p&&p.bDestroy===true){n="";}P.callFunction(m,{name:"/ExitApplication",success:p.fnSuccess,error:p.fnError,urlParameters:{Pernr:s,NewPernr:n}});}});});
